

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Internal Hooks &mdash; Bcome 1.3.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="External Hooks" href="external_hooks.html" />
    <link rel="prev" title="The metadata framework" href="metadata_framework.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Bcome
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">What is Bcome?</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../what/about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../what/quick_look.html">A quick look</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../starting/installation.html">Installation</a></li>
</ul>
<p class="caption"><span class="caption-text">Namespace Configuration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../namespaces/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../namespaces/basic_configuration.html">Basic configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../namespaces/connecting_clouds.html">Connecting clouds</a></li>
<li class="toctree-l1"><a class="reference internal" href="../namespaces/cleaning_up_server_names.html">Cleaning up server names</a></li>
<li class="toctree-l1"><a class="reference internal" href="../namespaces/caching_server_lookups.html">Caching server lookups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../namespaces/inventory_filtering.html">Inventory filtering</a></li>
<li class="toctree-l1"><a class="reference internal" href="../namespaces/sub_selected_inventories.html">Sub-selected inventories</a></li>
</ul>
<p class="caption"><span class="caption-text">SSH configuration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../ssh_configuration/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ssh_configuration/direct_connections.html">Direct connections</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ssh_configuration/proxied_connections.html">Proxied connections</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ssh_configuration/bootstrapping.html">Bootstrapping</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ssh_configuration/configuration_inheritance.html">Configuration Inheritance</a></li>
</ul>
<p class="caption"><span class="caption-text">Usage</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../usage/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/navigation.html">Navigation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/commands.html">Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/caching_inventories.html">Caching Inventories</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/testing_connections.html">Testing connections</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/ssh_to_a_server.html">SSH</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/executing_commands.html">Executing commands with run</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/pseudo_tty.html">Pseudo tty</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/file_transfers.html">File transfers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/interactive_mode.html">Interactive Mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/bootstrapping_mode.html">Bootstrapping mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/port_forwarding.html">Port Forwarding</a></li>
</ul>
<p class="caption"><span class="caption-text">Basic Scripting</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../scripting/bash_scripting.html">Bash scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scripting/ruby_scripting.html">Basic ruby scripting</a></li>
</ul>
<p class="caption"><span class="caption-text">Orchestration</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="registry.html">The Registry</a></li>
<li class="toctree-l1"><a class="reference internal" href="metadata_framework.html">The metadata framework</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Internal Hooks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-orchestration-directory">The orchestration directory</a></li>
<li class="toctree-l2"><a class="reference internal" href="#a-simple-orchestration-example">A simple orchestration example</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#setup">Setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="#accessing-your-namespace">Accessing your namespace</a></li>
<li class="toctree-l3"><a class="reference internal" href="#what-can-you-do-with-node">What can you do with &#64;node?</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#passing-parameters">Passing Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="#invoking-an-orchestration-klass-from-within-another">Invoking an orchestration klass from within another</a></li>
<li class="toctree-l2"><a class="reference internal" href="#traversing-contexts">Traversing contexts</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="external_hooks.html">External Hooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="tags.html">Tags</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Bcome</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Internal Hooks</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/orchestration/internal_hooks.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="internal-hooks">
<h1>Internal Hooks<a class="headerlink" href="#internal-hooks" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>If you haven’t already, read up on how the registry allows you to reference your own Ruby extensions to your Bcome framework installation, in the form of internal scripts.</p>
<p>This section deals with how you write these scripts.</p>
</div>
<div class="section" id="the-orchestration-directory">
<h2>The orchestration directory<a class="headerlink" href="#the-orchestration-directory" title="Permalink to this headline">¶</a></h2>
<p>Within your bcome project directory, create a directory named orchestration as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&gt; project
   <span class="p">|</span>- bcome
     <span class="p">|</span>- networks.yml
     <span class="p">|</span>- registry.yml
   <span class="p">|</span>- orchestration
</pre></div>
</div>
<p>Bcome will expect to find all referenced orchestration scripts within this directory.</p>
</div>
<div class="section" id="a-simple-orchestration-example">
<h2>A simple orchestration example<a class="headerlink" href="#a-simple-orchestration-example" title="Permalink to this headline">¶</a></h2>
<div class="section" id="setup">
<h3>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h3>
<p>Let’s say you have the following declaration within your registry.yml:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="s">&quot;foo:bar&quot;</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">internal</span>
    <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="s">&quot;synchronize</span><span class="nv"> </span><span class="s">puppet</span><span class="nv"> </span><span class="s">manifests&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">console_command</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">sync</span>
    <span class="l l-Scalar l-Scalar-Plain">group</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">puppet</span>
    <span class="l l-Scalar l-Scalar-Plain">orch_klass</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">PuppetSync</span>
</pre></div>
</div>
<p>When you invoke foo:bar:sync, Bcome will expect to find a ruby file named puppet_sync.rb within /path/to/your/project/bcome/orchestration/</p>
<p>The puppet_sync.rb needs to look as follows:</p>
<div class="highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="no">Module</span> <span class="no">Bcome</span><span class="o">::</span><span class="no">Orchestration</span>
  <span class="k">class</span> <span class="nc">PuppetSync</span> <span class="o">&lt;</span> <span class="no">Bcome</span><span class="o">::</span><span class="no">Orchestration</span><span class="o">::</span><span class="no">Base</span>

    <span class="k">def</span> <span class="nf">execute</span>
     <span class="o">...</span> <span class="n">your</span> <span class="n">orchestration</span> <span class="n">code</span>
    <span class="k">end</span>

  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p>Note that your orchestration script file must inherit from Bcome::Orchestration::Base</p>
</div>
<div class="section" id="accessing-your-namespace">
<h3>Accessing your namespace<a class="headerlink" href="#accessing-your-namespace" title="Permalink to this headline">¶</a></h3>
<p>Within your script, Bcome makes an instance variable named <a class="reference external" href="mailto:'&#37;&#52;&#48;node">‘<span>&#64;</span>node</a>’ available to you. This is an instance of your Bcome namespace.</p>
<p>For example, if you invoked the sync command from namespace foo:bar, where ‘bar’ is an inventory within collection ‘foo’, then &#64;node will represent your ‘foo’ inventory.</p>
<p>You can then work with &#64;node to implement your orchestration.</p>
<div class="highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="no">Module</span> <span class="no">Bcome</span><span class="o">::</span><span class="no">Orchestration</span>
  <span class="k">class</span> <span class="nc">PuppetSync</span> <span class="o">&lt;</span> <span class="no">Bcome</span><span class="o">::</span><span class="no">Orchestration</span><span class="o">::</span><span class="no">Base</span>

    <span class="k">def</span> <span class="nf">execute</span>
      <span class="c1"># @node = your namespace object</span>
    <span class="k">end</span>

  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="what-can-you-do-with-node">
<h3>What can you do with &#64;node?<a class="headerlink" href="#what-can-you-do-with-node" title="Permalink to this headline">¶</a></h3>
<p>Every method available within Bcome for a given namespace is available to the &#64;node instance. See the command list for a full list.</p>
<p>A number of accessors are also available to you.</p>
</div>
</div>
<div class="section" id="passing-parameters">
<h2>Passing Parameters<a class="headerlink" href="#passing-parameters" title="Permalink to this headline">¶</a></h2>
<p>Internal orchestration scripts can also take parameters. This is in the form of a hash, keyed on a variable called defaults, as follows:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="s">&quot;foo:bar&quot;</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">internal</span>
    <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="s">&quot;synchronize</span><span class="nv"> </span><span class="s">puppet</span><span class="nv"> </span><span class="s">manifests&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">console_command</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">sync</span>
    <span class="l l-Scalar l-Scalar-Plain">group</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">puppet</span>
    <span class="l l-Scalar l-Scalar-Plain">orch_klass</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">PuppetSync</span>
    <span class="l l-Scalar l-Scalar-Plain">defaults</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">value1</span><span class="p p-Indicator">:</span> <span class="s">&quot;foo&quot;</span>
      <span class="l l-Scalar l-Scalar-Plain">value2</span><span class="p p-Indicator">:</span> <span class="s">&quot;bar&quot;</span>
</pre></div>
</div>
<p>From your orchestration scripts, these defaults are accessible from an instance variable named &#64;arguments. For example:</p>
<div class="highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="no">Module</span> <span class="no">Bcome</span><span class="o">::</span><span class="no">Orchestration</span>
  <span class="k">class</span> <span class="nc">PuppetSync</span> <span class="o">&lt;</span> <span class="no">Bcome</span><span class="o">::</span><span class="no">Orchestration</span><span class="o">::</span><span class="no">Base</span>

    <span class="k">def</span> <span class="nf">execute</span>
      <span class="c1"># @node = your namespace object</span>
      <span class="c1"># @arguments = { :value1 =&gt; &quot;foo&quot;, :value2 =&gt; &quot;bar&quot; }</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p>As the naming suggests, these parameters are default parameters, and you can override them to pass in different values.</p>
<p>For example, to invoke the above using keyed access from your terminal, and defaulting to the default parameters you would:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&gt; bcome foo:bar:sync
</pre></div>
</div>
<p>And to override any of the parameters:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&gt; bcome foo:bar:sync <span class="nv">value1</span><span class="o">=</span>your-value
&gt; bcome foo:bar:sync <span class="nv">value2</span><span class="o">=</span>your-value
&gt; bcome foo:bar:sync <span class="nv">value1</span><span class="o">=</span>your-value <span class="nv">value2</span><span class="o">=</span>your-value
</pre></div>
</div>
<p>Remember that if you’re ever unsure as to how to invoke your orchestration klass, call up the ‘registry’ function for your namespace, and your commands and their usage will be shown:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&gt; bcome foo:bar:registry
</pre></div>
</div>
<p>Remember also that registry commands may also be triggered from the Bcome shell.</p>
</div>
<div class="section" id="invoking-an-orchestration-klass-from-within-another">
<h2>Invoking an orchestration klass from within another<a class="headerlink" href="#invoking-an-orchestration-klass-from-within-another" title="Permalink to this headline">¶</a></h2>
<p>It is easy to invoke orchestration script from within another.</p>
<div class="highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="n">orchestrator</span> <span class="o">=</span> <span class="o">::</span><span class="no">Bcome</span><span class="o">::</span><span class="no">Orchestration</span><span class="o">::</span><span class="no">MyOrchClass</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">arguments</span><span class="p">)</span>
<span class="n">orchestrator</span><span class="o">.</span><span class="n">do_execute</span>
</pre></div>
</div>
</div>
<div class="section" id="traversing-contexts">
<h2>Traversing contexts<a class="headerlink" href="#traversing-contexts" title="Permalink to this headline">¶</a></h2>
<p>Although internal scripts are called within the context of a specific namespace available from the &#64;node instance variable, you are not restricted to working solely with this namespace.</p>
<p>For example: you may load in servers from inventory namespaces, or inventories from collection namespace. You may also directly load in unrelated namespaces using the Bcome::Orchestrator class.</p>
<p>See the basic ruby script usage for more information: <a class="reference internal" href="../scripting/ruby_scripting.html"><span class="doc">Basic ruby scripting</span></a></p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="external_hooks.html" class="btn btn-neutral float-right" title="External Hooks" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="metadata_framework.html" class="btn btn-neutral" title="The metadata framework" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, webzakimbo

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>
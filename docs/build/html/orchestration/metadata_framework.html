

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>The metadata framework &mdash; Bcome 1.3.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Internal Hooks" href="internal_hooks.html" />
    <link rel="prev" title="The Registry" href="registry.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Bcome
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">What is Bcome?</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../what/about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../what/quick_look.html">A quick look</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../starting/installation.html">Installation</a></li>
</ul>
<p class="caption"><span class="caption-text">Namespace Configuration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../namespaces/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../namespaces/basic_configuration.html">Basic configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../namespaces/connecting_clouds.html">Connecting clouds</a></li>
<li class="toctree-l1"><a class="reference internal" href="../namespaces/cleaning_up_server_names.html">Cleaning up server names</a></li>
<li class="toctree-l1"><a class="reference internal" href="../namespaces/caching_server_lookups.html">Caching server lookups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../namespaces/inventory_filtering.html">Inventory filtering</a></li>
<li class="toctree-l1"><a class="reference internal" href="../namespaces/sub_selected_inventories.html">Sub-selected inventories</a></li>
</ul>
<p class="caption"><span class="caption-text">SSH configuration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../ssh_configuration/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ssh_configuration/direct_connections.html">Direct connections</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ssh_configuration/proxied_connections.html">Proxied connections</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ssh_configuration/bootstrapping.html">Bootstrapping</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ssh_configuration/configuration_inheritance.html">Configuration Inheritance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ssh_configuration/making_use_of_your_local_config.html">Making use of your local SSH config</a></li>
</ul>
<p class="caption"><span class="caption-text">Usage</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../usage/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/navigation.html">Navigation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/commands.html">Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/caching_inventories.html">Caching Inventories</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/testing_connections.html">Testing connections</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/ssh_to_a_server.html">SSH</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/executing_commands.html">Executing commands with run</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/pseudo_tty.html">Pseudo tty</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/file_transfers.html">File transfers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/interactive_mode.html">Interactive Mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/bootstrapping_mode.html">Bootstrapping mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/port_forwarding.html">Port Forwarding</a></li>
</ul>
<p class="caption"><span class="caption-text">Basic Scripting</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../scripting/bash_scripting.html">Bash scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scripting/ruby_scripting.html">Basic ruby scripting</a></li>
</ul>
<p class="caption"><span class="caption-text">Orchestration</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="registry.html">The Registry</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">The metadata framework</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#defining-metadata">Defining Metadata</a></li>
<li class="toctree-l2"><a class="reference internal" href="#using-metadata-in-scripts">Using metadata in scripts</a></li>
<li class="toctree-l2"><a class="reference internal" href="#encrypting-metadata">Encrypting Metadata</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#encryption">Encryption</a></li>
<li class="toctree-l3"><a class="reference internal" href="#decryption">Decryption</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="internal_hooks.html">Internal Hooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="external_hooks.html">External Hooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="tags.html">Tags</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Bcome</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>The metadata framework</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/orchestration/metadata_framework.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="the-metadata-framework">
<h1>The metadata framework<a class="headerlink" href="#the-metadata-framework" title="Permalink to this headline">¶</a></h1>
<p>When scripting or otherwise interacting with the Bcome shell the framework lets you access user-defined metadata. This is useful when writing orchestration scripts.</p>
<div class="section" id="defining-metadata">
<h2>Defining Metadata<a class="headerlink" href="#defining-metadata" title="Permalink to this headline">¶</a></h2>
<p>To get started, create a directory called metadata within your project as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&gt;project
  <span class="p">|</span>- bcome
    <span class="p">|</span>- metadata/
</pre></div>
</div>
<p>Within the metadata directory, create a yaml file. It doesn’t matter what this is called - within the metadata directory Bcome will load up any .yml file it finds, and load them all into memory.</p>
<p>Let’s say you have the following reference network configuration:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root <span class="o">(</span>collection<span class="o">)</span>
  <span class="p">|</span>- staging <span class="o">(</span>inventory<span class="o">)</span>
    <span class="p">|</span>- app1 <span class="o">(</span>server<span class="o">)</span>
  <span class="p">|</span>- qa <span class="o">(</span>inventory<span class="o">)</span>
    <span class="p">|</span>- app1 <span class="o">(</span>server<span class="o">)</span>
  <span class="p">|</span>- production <span class="o">(</span>inventory<span class="o">)</span>
    <span class="p">|</span>- app1 <span class="o">(</span>server<span class="o">)</span>
    <span class="p">|</span>- app2 <span class="o">(</span>server<span class="o">)</span>
</pre></div>
</div>
<p>And let’s say you have a  metadata file called mydata.yml. You can begin to add metadata into this file as follows:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="l l-Scalar l-Scalar-Plain">:root</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">value1</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">some value available to &#39;root&#39;</span>
  <span class="l l-Scalar l-Scalar-Plain">value2</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">some other value available to &#39;root&#39;</span>

<span class="l l-Scalar l-Scalar-Plain">:root:staging</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">value1</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">a value available to &#39;staging&#39; within &#39;root&#39;</span>

<span class="l l-Scalar l-Scalar-Plain">:root:staging:app1</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">value1</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">a value available to &#39;app1&#39; within &#39;staging&#39; within &#39;root&#39;</span>
</pre></div>
</div>
<p>Above, we have defined metadata for ‘root’, ‘root:staging’ and ‘root:staging:app1’.</p>
<p>Note that any metadata defined for ‘root’ will also be made available to all lower namespaces: e.g. ‘:root:staging’ has access to what has been defined in ‘root’, as does ‘root:staging:app1’: metadata is inherited down namespaces, and can be overriden.</p>
</div>
<div class="section" id="using-metadata-in-scripts">
<h2>Using metadata in scripts<a class="headerlink" href="#using-metadata-in-scripts" title="Permalink to this headline">¶</a></h2>
<p>Any Ruby script incorporating Bcome functionality e.g. a basic ruby script, internal or external script, may access Bcome’s metadata framework.</p>
<p>Given a Ruby object representing a Bcome namespace, &#64;node, a fetcher is provided:</p>
<div class="highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="n">metadata_value</span> <span class="o">=</span> <span class="vi">@node</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="ss">:metadata_key</span><span class="p">)</span>
<span class="c1"># OR - you may supply a default value, should the key you request not be defined</span>
<span class="n">metadata_value</span> <span class="o">=</span> <span class="vi">@node</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="ss">:metadata_key</span><span class="p">,</span> <span class="p">{</span><span class="ss">:some</span> <span class="o">=&gt;</span> <span class="ss">:default</span> <span class="p">}</span>
</pre></div>
</div>
<p>To view what metadata is configured for a given Bcome namespace node, you may instruct Bcome to output the metadata. For example, given namespace foo:bar:</p>
<p>Using keyed access:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&gt; bcome foo:bar:meta
</pre></div>
</div>
<p>From the shell</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&gt; bcome foo:bar
&gt;foo&gt; bar&gt; meta
</pre></div>
</div>
<p>Or within your script, where &#64;node is an instance variable holding a given namespace:</p>
<div class="highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="nb">puts</span> <span class="vi">@node</span><span class="o">.</span><span class="n">meta</span>
</pre></div>
</div>
<p>To return an object containing all configured metadata available for a given namespace:</p>
<p>From the shell:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&gt; bcome foo:bar
foo&gt; bar&gt; metadata
</pre></div>
</div>
<p>From a script:</p>
<div class="highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="vi">@node</span><span class="o">.</span><span class="n">metadata</span> <span class="c1"># for the object wrapper</span>
<span class="vi">@node</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">data</span> <span class="c1"># for a raw hash</span>
</pre></div>
</div>
</div>
<div class="section" id="encrypting-metadata">
<h2>Encrypting Metadata<a class="headerlink" href="#encrypting-metadata" title="Permalink to this headline">¶</a></h2>
<p>Any metadata files included within your metadata directory may be encrypted with a single key. This allows you to exclude raw metadata files that may contain sensitive information from your source control, and push up encrypted versions instead. The framework will always utilise your encrypted files during its runtime, and will prompt you for your encryption key the first time your encrypted files are required.</p>
<div class="section" id="encryption">
<h3>Encryption<a class="headerlink" href="#encryption" title="Permalink to this headline">¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&gt; bcome pack_metadata
</pre></div>
</div>
<p>You’ll be prompted for an encryption key. Note that if you re-encrypt your files (e.g. after you’ve modified your data), your encryption key must match the initial key used to encrypt your files.</p>
<p>Once your metadata is encrypted, Bcome will make us of your encrypted metadata files during its runtime, prompting you for the key the initial time it decrypts your data for use.</p>
</div>
<div class="section" id="decryption">
<h3>Decryption<a class="headerlink" href="#decryption" title="Permalink to this headline">¶</a></h3>
<p>When you need to work on your metadata files, you may unpack them as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&gt; bcome unpack_metadata
</pre></div>
</div>
<p>You’ll be prompted for an encryption key.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="internal_hooks.html" class="btn btn-neutral float-right" title="Internal Hooks" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="registry.html" class="btn btn-neutral" title="The Registry" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, webzakimbo

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Basic ruby scripting &mdash; Bcome 1.3.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="The Registry" href="../orchestration/registry.html" />
    <link rel="prev" title="Bash scripting" href="bash_scripting.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Bcome
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">What is Bcome?</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../what/about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../what/quick_look.html">A quick look</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../starting/installation.html">Installation</a></li>
</ul>
<p class="caption"><span class="caption-text">Namespace Configuration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../namespaces/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../namespaces/basic_configuration.html">Basic configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../namespaces/connecting_clouds.html">Connecting clouds</a></li>
<li class="toctree-l1"><a class="reference internal" href="../namespaces/cleaning_up_server_names.html">Cleaning up server names</a></li>
<li class="toctree-l1"><a class="reference internal" href="../namespaces/caching_server_lookups.html">Caching server lookups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../namespaces/inventory_filtering.html">Inventory filtering</a></li>
<li class="toctree-l1"><a class="reference internal" href="../namespaces/sub_selected_inventories.html">Sub-selected inventories</a></li>
</ul>
<p class="caption"><span class="caption-text">SSH configuration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../ssh_configuration/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ssh_configuration/direct_connections.html">Direct connections</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ssh_configuration/proxied_connections.html">Proxied connections</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ssh_configuration/bootstrapping.html">Bootstrapping</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ssh_configuration/configuration_inheritance.html">Configuration Inheritance</a></li>
</ul>
<p class="caption"><span class="caption-text">Usage</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../usage/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/navigation.html">Navigation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/commands.html">Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/caching_inventories.html">Caching Inventories</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/testing_connections.html">Testing connections</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/ssh_to_a_server.html">SSH</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/executing_commands.html">Executing commands with run</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/pseudo_tty.html">Pseudo tty</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/file_transfers.html">File transfers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/interactive_mode.html">Interactive Mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/bootstrapping_mode.html">Bootstrapping mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/port_forwarding.html">Port Forwarding</a></li>
</ul>
<p class="caption"><span class="caption-text">Basic Scripting</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="bash_scripting.html">Bash scripting</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Basic ruby scripting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#basics">Basics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#network-configuration">Network configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#script-requirements">Script requirements</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#executing-a-script">Executing a script</a></li>
<li class="toctree-l2"><a class="reference internal" href="#methods">Methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="#accessors">Accessors</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#for-all-namespaces">For all namespaces</a></li>
<li class="toctree-l3"><a class="reference internal" href="#for-sub-selected-inventories">For sub-selected inventories</a></li>
<li class="toctree-l3"><a class="reference internal" href="#for-servers">For servers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#for-all-inventory-types">for all inventory types</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#accessing-metadata">Accessing Metadata</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#to-list-metadata">To list metadata</a></li>
<li class="toctree-l3"><a class="reference internal" href="#to-retrieve-metadata">To retrieve metadata</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Orchestration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../orchestration/registry.html">The Registry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../orchestration/metadata_framework.html">The metadata framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../orchestration/internal_hooks.html">Internal Hooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../orchestration/external_hooks.html">External Hooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../orchestration/tags.html">Tags</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Bcome</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Basic ruby scripting</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/scripting/ruby_scripting.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="basic-ruby-scripting">
<h1>Basic ruby scripting<a class="headerlink" href="#basic-ruby-scripting" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>Bcome lets you write pure Ruby scripts that can interact with your installation. Using this you can:</p>
<ul class="simple">
<li>interact programmatically with your namespaces and their resources</li>
<li>access all features of Bcome that are otherwise accessible from the shell or by keyed-access</li>
</ul>
<p>Basic ruby scripts are not integrated directly into your Bcome framework, and are executed as standalone scripts. Within these scripts you expressely define the namespaces with which you wish to interact.</p>
<p>This will allow you also to integrate Bcome functionality into your other Ruby projects.</p>
</div>
<div class="section" id="basics">
<h2>Basics<a class="headerlink" href="#basics" title="Permalink to this headline">¶</a></h2>
<div class="section" id="network-configuration">
<h3>Network configuration<a class="headerlink" href="#network-configuration" title="Permalink to this headline">¶</a></h3>
<p>Let’s assume that we have the following basic network configuration:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>root <span class="o">(</span>collection<span class="o">)</span>
  <span class="p">|</span>- staging <span class="o">(</span>inventory<span class="o">)</span>
    <span class="p">|</span>- app1 <span class="o">(</span>server<span class="o">)</span>
    <span class="p">|</span>- app2 <span class="o">(</span>server<span class="o">)</span>
</pre></div>
</div>
<p>We have a single collection, containing a single inventory, containing two application servers.</p>
</div>
<div class="section" id="script-requirements">
<h3>Script requirements<a class="headerlink" href="#script-requirements" title="Permalink to this headline">¶</a></h3>
<p>At the top of your ruby script, you’ll need the following:</p>
<div class="highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="nb">require</span> <span class="s1">&#39;bcome&#39;</span>

<span class="no">ORCH</span> <span class="o">=</span> <span class="no">Bcome</span><span class="o">::</span><span class="no">Orchestrator</span><span class="o">.</span><span class="n">instance</span>
<span class="c1"># ORCH is an instance of Bcome’s Orchestrator that allows us to retrieve namespaces.</span>
</pre></div>
</div>
<p>Let’s expand our script to load in the staging inventory:</p>
<div class="highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="nb">require</span> <span class="s1">&#39;bcome&#39;</span>
<span class="no">ORCH</span> <span class="o">=</span> <span class="no">Bcome</span><span class="o">::</span><span class="no">Orchestrator</span><span class="o">.</span><span class="n">instance</span>

<span class="n">inventory</span> <span class="o">=</span> <span class="no">ORCH</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;staging&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that the root namespace is implicit.</p>
<p>If we wanted to load in app1 we would do the following:</p>
<div class="highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
 <span class="n">app1</span> <span class="o">=</span> <span class="no">ORCH</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;staging:app1&quot;</span><span class="p">)</span>
<span class="o">...</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="executing-a-script">
<h2>Executing a script<a class="headerlink" href="#executing-a-script" title="Permalink to this headline">¶</a></h2>
<p>Ruby script execution is the same as for any other Ruby script:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&gt; ruby path/to/your/script.rb
</pre></div>
</div>
</div>
<div class="section" id="methods">
<h2>Methods<a class="headerlink" href="#methods" title="Permalink to this headline">¶</a></h2>
<p>Every method available within Bcome for a given namespace is available to the namespaces retrieved within your scripts (see the command list for a full list).</p>
<p>Remember that to list all integrated Bcome functions for a given namespace, you can invoke the menu function, i.e.</p>
<div class="highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="nb">require</span> <span class="s1">&#39;bcome&#39;</span>
<span class="no">ORCH</span> <span class="o">=</span> <span class="no">Bcome</span><span class="o">::</span><span class="no">Orchestrator</span><span class="o">.</span><span class="n">instance</span>
<span class="n">inventory</span> <span class="o">=</span> <span class="no">ORCH</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;staging&quot;</span><span class="p">)</span>
<span class="n">inventory</span><span class="o">.</span><span class="n">menu</span>
</pre></div>
</div>
<p>If you’ve defined your own registry commands, then these will also be available.</p>
<p>You can show your configured registry methods for a given namespace by invoking the registry function, i.e.</p>
<div class="highlight-ruby notranslate"><div class="highlight"><pre><span></span><span class="no">ORCH</span> <span class="o">=</span> <span class="no">Bcome</span><span class="o">::</span><span class="no">Orchestrator</span><span class="o">.</span><span class="n">instance</span>
<span class="n">inventory</span> <span class="o">=</span> <span class="no">ORCH</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;staging:app1&quot;</span><span class="p">)</span>
<span class="n">inventory</span><span class="o">.</span><span class="n">registry</span>
</pre></div>
</div>
</div>
<div class="section" id="accessors">
<h2>Accessors<a class="headerlink" href="#accessors" title="Permalink to this headline">¶</a></h2>
<p>The following accessors are the most useful &amp; commonly used:</p>
<div class="section" id="for-all-namespaces">
<h3>For all namespaces<a class="headerlink" href="#for-all-namespaces" title="Permalink to this headline">¶</a></h3>
<p>keyed_namespace - returns a string representing the namespace’s Bcome breadcrumb</p>
<p>identifier - returns a string representing the namespace’s identifier</p>
<p>resources - returns an array of all resources belonging to a namespace, e.g. all the servers belonging to an inventory.</p>
<p>description - the description for the namespace from the network configuration,</p>
<p>type - the namespace type</p>
<p>meta - all configured metadata for this namespace level. See using metadata for more information.</p>
<p>proxy - returns the proxy object associated with a given namespace (if proxied SSH access has been configured)</p>
</div>
<div class="section" id="for-sub-selected-inventories">
<h3>For sub-selected inventories<a class="headerlink" href="#for-sub-selected-inventories" title="Permalink to this headline">¶</a></h3>
<p>parent - returns the parent inventory from which the sub-selected inventory is derived.</p>
</div>
<div class="section" id="for-servers">
<h3>For servers<a class="headerlink" href="#for-servers" title="Permalink to this headline">¶</a></h3>
<p>public_ip_address - returns the public IP address, if configured</p>
<p>internal_ip_address - returns the internal IP address, if configured.</p>
<p>ssh_driver.proxy - returns a Ruby Net::SSH::Proxy::Command object if your namespace has a proxy connection configured. This is useful should you wish to re-use your proxy settings in an external script, e.g. within a Capistrano deployment.</p>
<p>tags - returns all configured remote tags. See using tags for more information.</p>
</div>
<div class="section" id="for-all-inventory-types">
<h3>for all inventory types<a class="headerlink" href="#for-all-inventory-types" title="Permalink to this headline">¶</a></h3>
<p>machine_by_identifier(“servername”) - load up a server by name from your inventory. Returns a server node.</p>
</div>
</div>
<div class="section" id="accessing-metadata">
<h2>Accessing Metadata<a class="headerlink" href="#accessing-metadata" title="Permalink to this headline">¶</a></h2>
<p>The metadata framework makes all metadata available to your ruby scripts.</p>
<div class="section" id="to-list-metadata">
<h3>To list metadata<a class="headerlink" href="#to-list-metadata" title="Permalink to this headline">¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">ORCH</span> <span class="o">=</span> Bcome::Orchestrator.instance
<span class="nv">inventory</span> <span class="o">=</span> ORCH.get<span class="o">(</span><span class="s2">&quot;staging:app1&quot;</span><span class="o">)</span>
inventory.meta
</pre></div>
</div>
</div>
<div class="section" id="to-retrieve-metadata">
<h3>To retrieve metadata<a class="headerlink" href="#to-retrieve-metadata" title="Permalink to this headline">¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">ORCH</span> <span class="o">=</span> Bcome::Orchestrator.instance
<span class="nv">inventory</span> <span class="o">=</span> ORCH.get<span class="o">(</span><span class="s2">&quot;staging:app1&quot;</span><span class="o">)</span>
<span class="nv">value</span> <span class="o">=</span> inventory.metadata.fetch<span class="o">(</span>:key<span class="o">)</span>
</pre></div>
</div>
<p>See the metadata guide for more information on configuring and using metadata: <a class="reference internal" href="../orchestration/metadata_framework.html"><span class="doc">The metadata framework</span></a></p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../orchestration/registry.html" class="btn btn-neutral float-right" title="The Registry" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="bash_scripting.html" class="btn btn-neutral" title="Bash scripting" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, webzakimbo

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>